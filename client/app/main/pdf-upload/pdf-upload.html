<div class="heading row">
  <h3>Upload Absence Report</h3>
</div>
<div class="upload-form row">
  <form class="form-inline" name="forms.upload" ng-submit="submit()" ng-show="!isUploaded" novalidate>
    <div class="form-group"
      ng-class="data.upload.school ? 'has-success' : 'has-error'">
      <label>School</label>
      <ui-select theme="bootstrap" ng-model="data.upload.school" ng-disabled="defaultSchool" required>
        <ui-select-match class="ui-select-match" placeholder="Select a school">{{$select.selected.name}}</ui-select-match>
        <ui-select-choices class="ui-select-choices" repeat="school in schools | filter: $select.search">
          <div ng-bind-html="school.name | highlight: $select.search"></div>
        </ui-select-choices>
      </ui-select>
    </div>
    <div class="form-group"
      ng-class="{
        'has-error': forms.upload.file.$invalid && forms.upload.file.$dirty,
        'has-success': forms.upload.file.$valid
      }">
      <label class="control-label" for="pdfInput">PDF</label>
      <input id="pdfInput"
        class="form-control"
        type="file"
        name="file"
        ng-model="data.upload.file"
        ngf-pattern="'application/pdf'"
        ngf-select
        required>
    </div>
    <div class="form-group">
      <label class="control-label" for="date">Date</label>
      <input type="date"
        class="form-control"
        ng-model="date"
        required>
    </div>
    <button class="btn btn-primary" type="submit" ng-disabled="forms.upload.$invalid || data.upload.processingUpload">
      Submit
    </button>
  </form>
  <div ng-if="forms.upload.file.$invalid && forms.upload.file.$dirty" class="form-group has-error">
    <div ng-messages="forms.upload.file.$error" class="help-block">
      <div ng-message-exp="['required', 'pattern']"><span class="label label-warning">Choose an absence report PDF to upload</span>
      </div>
      <div ng-message="server"><span class="label label-danger">{{data.upload.fileError}}</span></div>
    </div>
  </div>
  <div ng-if="!forms.upload.$dirty" class="form-group has-success">
    <div class="help-block"><span class="label label-primary">{{data.upload.message}}</span></div>
  </div>
  <div ng-if="isUploaded" class="row confirm-table">
    <div class="row">
      <button class="btn btn-success" ng-click="confirmUpload()">Confirm Upload</button>
      <button class="btn btn-danger" ng-click="cancelUpload()">Cancel Upload</button>
    </div>
    <div class="table-responsive">
      <table class="table table-condensed">
        <h2>{{schoolName}}</h2>
        <thead class="cf">
        <tr>
          <th>Name</th>
          <th>Student Id</th>
          <th>Absences</th>
          <th>Δ Absences</th>
          <th>Tardies</th>
          <th>Δ Tardies</th>
          <th>Present</th>
          <th>Enrolled</th>
          <th>Interventions</th>
        </tr>
        </thead>
        <tr class="info" ng-if="result.data.creates">
          <th>New Students</th>
        </tr>
        <tr class="info" ng-if="result.data.creates" ng-repeat="listing in result.data.creates">
          <td data-title="Name">{{listing.student.lastName}}, {{listing.student.firstName}}</td>
          <td data-title="Student Id">{{listing.student.studentId}}</td>
          <td data-title="Absences">{{listing.entry.absences}}</td>
          <td data-title="Δ Absences">{{listing.entry.absencesDelta}}</td>
          <td data-title="Tardies">{{listing.entry.tardies}}</td>
          <td data-title="Δ Tardies">{{listing.entry.tardiesDelta}}</td>
          <td data-title="Present">{{listing.entry.present}}</td>
          <td data-title="Enrolled">{{listing.entry.enrolled}}</td>
          <td data-title="Interventions">{{listing.entry.interventions.length}}</td>
        </tr>
        <tr class="success" ng-if="result.data.updates">
          <th>Existing Students</th>
        </tr>
        <tr class="success" ng-if="result.data.updates" ng-repeat="listing in result.data.updates">
          <td data-title="Name">{{listing.student.lastName}}, {{listing.student.firstName}}</td>
          <td data-title="Student Id">{{listing.student.studentId}}</td>
          <td data-title="Absences">{{listing.entry.absences}}</td>
          <td data-title="Δ Absences">{{listing.entry.absencesDelta}}</td>
          <td data-title="Tardies">{{listing.entry.tardies}}</td>
          <td data-title="Δ Tardies">{{listing.entry.tardiesDelta}}</td>
          <td data-title="Present">{{listing.entry.present}}</td>
          <td data-title="Enrolled">{{listing.entry.enrolled}}</td>
          <td data-title="Interventions">{{listing.entry.interventions.length}}</td>
        </tr>
      </table>
    </div>
  </div>
</div>
